<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flight Countdown — ORD→DXB→DAC</title>
  <style>
    :root{
  --bg1: #101827;
  --bg2: #0b1220;
  --bg3: #070b15;
      --card: rgba(255,255,255,.06);
      --card-2: rgba(255,255,255,.1);
  --txt: #e5e7eb;
  --font-main: 'Inter', 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      --muted: #a8b3cf;
      --accent: #60a5fa;
      --accent-2: #34d399;
      --danger: #f87171;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
  margin:0; font-family: var(--font-main);
  /* Typography hierarchy */
  h1, .title { font-family: var(--font-main); font-weight: 700; font-size: clamp(24px, 3vw, 36px); letter-spacing: .01em; }
  h2, .big { font-family: var(--font-main); font-weight: 700; font-size: clamp(18px, 2vw, 24px); letter-spacing: .02em; }
  .sub, .small, .lbl, .meta .k { font-family: var(--font-main); font-size: 14px; color: var(--muted); }
  .meta .v { font-family: var(--font-main); font-weight: 600; font-size: 16px; }
      color: var(--txt);
  background: linear-gradient(120deg, var(--bg1) 0%, var(--bg2) 60%, var(--bg3) 100%);
  animation: bgmove 12s ease-in-out infinite alternate;
  position:relative;
  min-height:100vh;
    @keyframes bgmove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
      overflow-x:hidden;
    }
    .wrap{max-width:980px;margin:0 auto;padding:32px}
    header{display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .title{font-weight:700;font-size: clamp(22px, 3vw, 34px)}
    .sub{color:var(--muted);font-size:14px}
    .card{
      background: linear-gradient(180deg, var(--card), transparent), var(--card);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 20px; 
      padding: 22px; 
      box-shadow: 0 8px 32px rgba(0,0,0,.38), 0 1.5px 0 rgba(255,255,255,.08), 0 0.5px 0 rgba(96,165,250,.08);
      backdrop-filter: blur(10px);
      transition: box-shadow 0.3s, transform 0.3s;
    }
    .card:hover {
      box-shadow: 0 16px 64px rgba(0,0,0,.48), 0 2px 0 rgba(96,165,250,.18);
      transform: translateY(-2px) scale(1.012);
    }
    .row{display:grid; grid-template-columns: 1fr; gap:18px}
    @media (min-width: 840px){ .row{grid-template-columns: 1.1fr .9fr}}

    .countdown{
      display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:14px; margin-top:16px
    }
    .chip{display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--card-2);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:18px 10px}
    .num{font-variant-numeric: tabular-nums; font-weight:800; font-size: clamp(26px, 6vw, 46px)}
.num{
  color: var(--accent);
  text-shadow: 0 2px 8px rgba(96,165,250,.18);
  transition: color 0.2s, text-shadow 0.2s;
}
    .lbl{margin-top:6px;color:var(--muted);font-size:12px;letter-spacing:.12em;text-transform:uppercase}

    .seg{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .pill {
      border:1.5px solid var(--accent);
      padding:8px 12px;
      border-radius:12px;
      cursor:pointer;
      background: rgba(96,165,250,.09);
      color:var(--accent);
      font-weight:600;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
    }
    .pill.active {
      outline:2.5px solid var(--accent-2);
      box-shadow:0 0 0 6px rgba(52,211,153,.18);
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color:#062b1f;
    }
    .meta{display:grid;grid-template-columns: 1fr 1fr; gap:12px; margin-top:14px}
    .meta .k{color:var(--muted);font-size:12px}
    .meta .v{font-weight:600}

    .progress{height:10px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .5s ease}

    .footer{color:var(--muted);font-size:12px;margin-top:18px}
    .small{font-size:12px;color:var(--muted)}
    .big{font-size: clamp(18px, 2.2vw, 22px); font-weight:700}
.big{
  color: var(--accent-2);
  letter-spacing: .04em;
  text-shadow: 0 2px 8px rgba(52,211,153,.12);
}

    .grid2{display:grid;grid-template-columns:1fr;gap:14px}
    @media (min-width: 560px){.grid2{grid-template-columns:1fr 1fr}}

    button.inline{
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color:#062b1f;
      border:none;
      padding:8px 12px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 2px 8px rgba(96,165,250,.12);
      transition: background 0.2s, box-shadow 0.2s;
    }
    button.inline:hover{
      background: linear-gradient(90deg, var(--accent-2), var(--accent));
      box-shadow: 0 4px 16px rgba(52,211,153,.18);
    /* Animated particles background */
    .particles {
  position: fixed;
  top: 0; left: 0; width: 100vw; height: 100vh;
  pointer-events: none;
  z-index: 0;
  margin: 0 !important;
  padding: 0 !important;
  display: block;
  border: none;
  box-sizing: border-box;
  opacity: 0.7;
  filter: blur(0.5px) brightness(0.95);
    }
    }
    .danger{color:var(--danger)}
    a{color:var(--accent)}
  </style>
</head>
<body>
  <canvas class="particles" style="position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:0;display:block;margin:0;padding:0;border:none;"></canvas>
  <div class="wrap">
    <header>
      <div>
        <div class="title">✈️ <b>Homecoming</b></div>
        <div class="sub">ORD → DXB → DAC • Emirates EK236 + EK582</div>
      </div>
  <div class="small" id="now"></div>
  <div class="small" id="userLoc" style="text-align:right;min-width:180px;"></div>
    </header>

    <div class="row">
      <!-- Map Card -->
      <section class="card" style="margin-top:18px">
        <div class="big">Route Map</div>
        <div id="map" style="height:340px; border-radius:16px; margin-top:12px;"></div>
        <div class="small" style="margin-top:8px">Flight paths and airport details are shown below.</div>
      </section>
      <!-- Left: Countdown Card -->
      <section class="card">
        <div class="seg" id="segmentTabs">
          <div class="pill active" data-key="ord_depart">ORD Departure</div>
          <div class="pill" data-key="dxb_depart">DXB Departure</div>
          <div class="pill" data-key="dac_arrive">DAC Arrival</div>
        </div>

        <div class="countdown" aria-live="polite">
          <div class="chip"><div class="num" id="dd">–</div><div class="lbl">Days</div></div>
          <div class="chip"><div class="num" id="hh">–</div><div class="lbl">Hours</div></div>
          <div class="chip"><div class="num" id="mm">–</div><div class="lbl">Minutes</div></div>
          <div class="chip"><div class="num" id="ss">–</div><div class="lbl">Seconds</div></div>
        </div>

        <div class="meta">
          <div>
            <div class="k">Target (local to event)</div>
            <div class="v" id="targetLocal">—</div>
          </div>
          <div>
            <div class="k">Target (your local time)</div>
            <div class="v" id="targetYour">—</div>
          </div>
          <div>
            <div class="k">Flight</div>
            <div class="v" id="flightInfo">—</div>
          </div>
          <div>
            <div class="k">Terminal / Note</div>
            <div class="v" id="terminal">—</div>
          </div>
        </div>

        <div style="margin:14px 0 6px" class="small">Progress to Bangladesh (from ORD departure → DAC arrival)</div>
        <div class="progress" title="Trip progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <i id="progressFill"></i>
        </div>

        <div class="footer">
          Tip: this page adjusts to your computer's timezone automatically. Add it to your phone's home screen for quick access.
        </div>
      </section>

      <!-- Right: Details / Notes Card -->
      <aside class="card">
        <div class="big">Itinerary</div>
        <div class="grid2" style="margin-top:10px">
          <div>
            <div class="k">EK236 • ORD → DXB</div>
            <div class="v">Check-in 15:45, Departs 19:45 (14 Dec 2025, <b>UTC−06</b>)</div>
            <div class="small">Arrives DXB 19:10 (15 Dec, UTC+04) • Terminal 3</div>
          </div>
          <div>
            <div class="k">EK582 • DXB → DAC</div>
            <div class="v">Check-in 01:30, Departs 04:30 (16 Dec 2025, <b>UTC+04</b>)</div>
            <div class="small">Arrives DAC 10:55 (16 Dec, UTC+06) • Terminal 1</div>
          </div>
        </div>
        <hr style="border-color:rgba(255,255,255,.1);margin:16px 0">
        <div class="small">One-click reminder: <button class="inline" id="icsBtn">Add .ics</button> <span id="icsMsg" class="small"></span></div>
        <div class="small" style="margin-top:10px">Sound alert (10 min before selected event): <button class="inline" id="soundBtn">Enable</button></div>
        <audio id="ping" preload="auto">
          <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQAAACAAACAgAGZ..." type="audio/mpeg">
        </audio>
        <p class="small" style="opacity:.8;margin-top:12px">Note: If your airline updates times, edit the code dates below or switch the target using the chips above.</p>
      </aside>
    </div>
  </div>

  <script>
    // Show user's current location and time
    async function showUserLocation() {
      const locEl = document.getElementById('userLoc');
      if (!locEl) return;
      locEl.textContent = 'Detecting location…';
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async pos => {
          const lat = pos.coords.latitude, lon = pos.coords.longitude;
          try {
            // Use OpenStreetMap Nominatim for reverse geocoding
            const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`;
            const res = await fetch(url);
            const data = await res.json();
            let place = data.address.city || data.address.town || data.address.village || data.address.county || '';
            let country = data.address.country || '';
            let locStr = place ? `${place}, ${country}` : country;
            locEl.innerHTML = `<span style="font-weight:600;color:var(--accent)">${locStr}</span>`;
          } catch(e) {
            locEl.textContent = 'Location unavailable.';
          }
        }, () => { locEl.textContent = 'Location unavailable.'; });
      } else {
        locEl.textContent = 'Location unavailable.';
      }
    }
    showUserLocation();
    // Simple animated particles background
    (() => {
      const canvas = document.querySelector('.particles');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      let w = window.innerWidth, h = window.innerHeight;
      canvas.width = w; canvas.height = h;
      window.addEventListener('resize', () => {
        w = window.innerWidth; h = window.innerHeight;
        canvas.width = w; canvas.height = h;
      });
      const particles = Array.from({length: 32}, () => ({
        x: Math.random()*w,
        y: Math.random()*h,
        r: Math.random()*2+1.5,
        dx: (Math.random()-0.5)*0.3,
        dy: (Math.random()-0.5)*0.3,
        c: `rgba(${60+Math.random()*80},${160+Math.random()*80},${250+Math.random()*40},${0.12+Math.random()*0.18})`
      }));
      function draw() {
        ctx.clearRect(0,0,w,h);
        for(const p of particles){
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.r,0,2*Math.PI);
          ctx.fillStyle=p.c;
          ctx.fill();
          p.x+=p.dx; p.y+=p.dy;
          if(p.x<0||p.x>w) p.dx*=-1;
          if(p.y<0||p.y>h) p.dy*=-1;
        }
        requestAnimationFrame(draw);
      }
      draw();
    })();
    // === Leaflet.js Map ===
    // Airport coordinates
    const airports = {
      ORD: { name: "Chicago O'Hare (ORD)", lat: 41.9742, lng: -87.9073 },
      DXB: { name: "Dubai Intl (DXB)", lat: 25.2532, lng: 55.3657 },
      DAC: { name: "Dhaka (DAC)", lat: 23.8433, lng: 90.3978 }
    };
    // Flight segments
    const flightSegments = [
      { from: airports.ORD, to: airports.DXB, label: "ORD → DXB", duration: "14h 25m" },
      { from: airports.DXB, to: airports.DAC, label: "DXB → DAC", duration: "5h 25m" }
    ];
    // Transit time
    const transitTime = "9h 20m";

    function initMap() {
      const map = L.map('map', {
        center: [30, 40],
        zoom: 3,
        scrollWheelZoom: false,
        attributionControl: false
      });
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 8,
        minZoom: 2
      }).addTo(map);
        // Weather API key
        const weatherApiKey = '7e22464f2cbe4542b99194844252110';

        // Haversine formula for distance
        function haversine(lat1, lon1, lat2, lon2) {
          const toRad = x => x * Math.PI / 180;
          const R = 6371; // km
          const dLat = toRad(lat2 - lat1);
          const dLon = toRad(lon2 - lon1);
          const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
          const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
          const km = R * c;
          return { km, mi: km * 0.621371 };
        }

        // Fetch weather for airport
        async function getWeather(lat, lon) {
          try {
            const url = `https://api.weatherapi.com/v1/current.json?key=${weatherApiKey}&q=${lat},${lon}`;
            const res = await fetch(url);
            const data = await res.json();
            if (data && data.current) {
              return `${data.current.temp_c}°C, ${data.current.condition.text}`;
            }
          } catch(e) {}
          return 'Weather unavailable';
        }

        // Markers with weather info
        Object.entries(airports).forEach(async ([code, ap]) => {
          const marker = L.marker([ap.lat, ap.lng]).addTo(map);
          marker.bindPopup(`<b>${ap.name}</b><br><span id="weather-${code}">Loading weather...</span>`);
          marker.on('popupopen', async () => {
            const weather = await getWeather(ap.lat, ap.lng);
            const el = document.getElementById(`weather-${code}`);
            if (el) el.textContent = weather;
          });
        });

        // Flight paths with distance labels
        flightSegments.forEach(seg => {
          const poly = L.polyline([
            [seg.from.lat, seg.from.lng],
            [seg.to.lat, seg.to.lng]
          ], {
            color: '#60a5fa', weight: 5, opacity: 0.7, dashArray: '10,8'
          }).addTo(map);
          const dist = haversine(seg.from.lat, seg.from.lng, seg.to.lat, seg.to.lng);
          poly.bindPopup(`<b>${seg.label}</b><br>Duration: ${seg.duration}<br>Distance: ${dist.km.toFixed(0)} km / ${dist.mi.toFixed(0)} mi`);
        });

        // Transit popup at DXB
        L.circleMarker([airports.DXB.lat, airports.DXB.lng], {
          radius: 8, color: '#34d399', fillColor: '#34d399', fillOpacity: 0.5
        }).addTo(map)
          .bindPopup(`<b>Transit at DXB</b><br>Time: ${transitTime}`);
    }

    // Load Leaflet after DOM
    window.addEventListener('DOMContentLoaded', () => {
      if(document.getElementById('map')) initMap();
    });
    // === Configure your flight milestones here (with explicit timezone offsets) ===
    const segments = {
      ord_depart: {
        label: "ORD Departure",
        flight: "EK236 — Chicago → Dubai",
        terminal: "ORD Intl. T5 • Economy Flex",
        // 14 Dec 2025 19:45 CST (UTC−06)
        ts: "2025-12-14T19:45:00-06:00",
        tz: "America/Chicago",
      },
      dxb_depart: {
        label: "DXB Departure",
        flight: "EK582 — Dubai → Dhaka",
        terminal: "DXB T3 • Economy Flex",
        // 16 Dec 2025 04:30 GST (UTC+04)
        ts: "2025-12-16T04:30:00+04:00",
        tz: "Asia/Dubai",
      },
      dac_arrive: {
        label: "DAC Arrival",
        flight: "EK582 Arrival — Dhaka",
        terminal: "Hazrat Shahjalal Intl. T1",
        // 16 Dec 2025 10:55 BST (UTC+06)
        ts: "2025-12-16T10:55:00+06:00",
        tz: "Asia/Dhaka",
      }
    };

    // Segment order and helper to find next upcoming
    const segmentOrder = ['ord_depart','dxb_depart','dac_arrive'];
    function getUpcomingKey(now = Date.now()){
      for(const k of segmentOrder){
        if(new Date(segments[k].ts).getTime() > now) return k;
      }
      return segmentOrder[segmentOrder.length-1];
    }

    // For overall progress bar (from first depart → final arrival)
    const tripStart = new Date(segments.ord_depart.ts).getTime();
    const tripEnd   = new Date(segments.dac_arrive.ts).getTime();

    const ddEl = document.getElementById('dd');
    const hhEl = document.getElementById('hh');
    const mmEl = document.getElementById('mm');
    const ssEl = document.getElementById('ss');
    const targetLocalEl = document.getElementById('targetLocal');
    const targetYourEl  = document.getElementById('targetYour');
    const flightInfoEl  = document.getElementById('flightInfo');
    const terminalEl    = document.getElementById('terminal');
    const progressFill  = document.getElementById('progressFill');
    const progressEl    = document.querySelector('.progress');
    const nowEl         = document.getElementById('now');

      // Live flight status
      const flightStatusEl = document.createElement('div');
      flightStatusEl.className = 'small';
      flightInfoEl.parentNode.appendChild(flightStatusEl);

      const aviationStackKey = '0b6376818a94a344cadfee0df29f4854';
      const flightNumbers = {
        ord_depart: 'EK236',
        dxb_depart: 'EK582',
        dac_arrive: 'EK582'
      };

      async function fetchFlightStatus(flightNum) {
        flightStatusEl.textContent = 'Loading live status...';
        try {
          const url = `https://api.aviationstack.com/v1/flights?access_key=${aviationStackKey}&flight_iata=${flightNum}`;
          const res = await fetch(url);
          const data = await res.json();
          if (!data || !data.data || !data.data.length) {
          flightStatusEl.textContent = 'Live status will be available closer to departure.';
            return;
          }
          // Find the next upcoming flight (by departure date)
          const now = Date.now();
          let best = null;
          for (const f of data.data) {
            if (f.departure && f.departure.scheduled) {
              const dep = new Date(f.departure.scheduled).getTime();
              if (dep > now && (!best || dep < new Date(best.departure.scheduled).getTime())) {
                best = f;
              }
            }
          }
          if (!best) best = data.data[0];
          // Status: scheduled, active, landed, cancelled, incident, diverted
          const status = best.flight_status || 'Unknown';
          let statusTxt = `Status: <b>${status.charAt(0).toUpperCase() + status.slice(1)}</b>`;
          if (best.departure && best.departure.actual) {
            statusTxt += `<br>Departed: ${new Date(best.departure.actual).toLocaleString()}`;
          } else if (best.departure && best.departure.scheduled) {
            statusTxt += `<br>Scheduled: ${new Date(best.departure.scheduled).toLocaleString()}`;
          }
          if (best.arrival && best.arrival.actual) {
            statusTxt += `<br>Arrived: ${new Date(best.arrival.actual).toLocaleString()}`;
          } else if (best.arrival && best.arrival.scheduled) {
            statusTxt += `<br>Arrival: ${new Date(best.arrival.scheduled).toLocaleString()}`;
          }
          flightStatusEl.innerHTML = statusTxt;
        } catch (e) {
          flightStatusEl.textContent = 'Error loading live status.';
        }
      }

    let activeKey = localStorage.getItem('flightCountdownActiveKey') || getUpcomingKey();
    if(!segments[activeKey]) activeKey = getUpcomingKey();
    if(new Date(segments[activeKey].ts).getTime() <= Date.now()){
      activeKey = getUpcomingKey();
    }

    function setActive(key){
      activeKey = key;
      localStorage.setItem('flightCountdownActiveKey', key);
      document.querySelectorAll('#segmentTabs .pill').forEach(p=>{
        p.classList.toggle('active', p.dataset.key===key)
      });
      const seg = segments[key];
      const t = new Date(seg.ts);
      const fmtLocal = new Intl.DateTimeFormat(undefined, { dateStyle:'full', timeStyle:'short', timeZone: seg.tz });
      targetLocalEl.textContent = fmtLocal.format(t);
      targetYourEl.textContent  = new Intl.DateTimeFormat(undefined, { dateStyle:'full', timeStyle:'short' }).format(t);
      flightInfoEl.textContent  = seg.flight;
      terminalEl.textContent    = seg.terminal;
        fetchFlightStatus(flightNumbers[key]);
      tick();
    }

    document.querySelectorAll('#segmentTabs .pill').forEach(p=>{
      p.addEventListener('click', () => setActive(p.dataset.key));
    });

    function pad(n){ return String(n).padStart(2,'0'); }

    function tick(){
      const now = Date.now();
      const tMs = new Date(segments[activeKey].ts).getTime();
      const delta = Math.max(0, tMs - now);

      // auto-advance to the next upcoming segment when current passes
      if(tMs - now <= 0){
        const next = getUpcomingKey(now);
        if(next !== activeKey){ setActive(next); return; }
      }

      const s = Math.floor(delta/1000);
      const d = Math.floor(s / 86400);
      const h = Math.floor((s % 86400) / 3600);
      const m = Math.floor((s % 3600) / 60);
      const r = s % 60;
      ddEl.textContent = d; hhEl.textContent = pad(h); mmEl.textContent = pad(m); ssEl.textContent = pad(r);

      // update clock label
      nowEl.textContent = `Your local time: ${new Date().toLocaleString(undefined,{dateStyle:'full', timeStyle:'medium'})}`;

      // progress from tripStart to tripEnd
      const prog = ((now - tripStart) / (tripEnd - tripStart)) * 100;
      const clamped = Math.max(0, Math.min(100, prog));
      progressFill.style.width = `${clamped}%`;
      if(progressEl){ progressEl.setAttribute('aria-valuenow', String(Math.round(clamped))); }
    }

    // Simple alert sound 10 minutes before chosen event
    let soundEnabled = false, sounded=false;
    const soundBtn = document.getElementById('soundBtn');
    const ping = document.getElementById('ping');
    soundBtn.addEventListener('click', async ()=>{
      soundEnabled = !soundEnabled; sounded=false; // reset on toggle
      soundBtn.textContent = soundEnabled ? 'Enabled' : 'Enable';
      if(soundEnabled){
        try{ await ping.play(); ping.pause(); ping.currentTime=0; }catch(e){}
      }
    });

    function soundTick(){
      if(!soundEnabled) return;
      const now = Date.now();
      const tMs = new Date(segments[activeKey].ts).getTime();
      const tenMin = 10*60*1000;
      if(!sounded && tMs - now <= tenMin && tMs - now > 0){ ping.play().catch(()=>{}); sounded=true; }
      if(tMs - now <= 0) sounded = true;
    }

    // .ics generator for the selected event
    document.getElementById('icsBtn').addEventListener('click', ()=>{
      const seg = segments[activeKey];
      const start = new Date(seg.ts);
      // create a 2-hour block by default
      const end = new Date(start.getTime() + 2*60*60*1000);
      function toICS(dt){ return dt.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}Z$/, 'Z'); }
      const ics = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Raqueed Flight Countdown//EN\nBEGIN:VEVENT\nUID:${crypto.randomUUID()}\nDTSTAMP:${toICS(new Date())}\nDTSTART:${toICS(start)}\nDTEND:${toICS(end)}\nSUMMARY:${seg.flight} — ${seg.label}\nDESCRIPTION:${seg.terminal}\nEND:VEVENT\nEND:VCALENDAR`;
      const blob = new Blob([ics],{type:'text/calendar'});
      const url = URL.createObjectURL(blob);
      const a = Object.assign(document.createElement('a'),{href:url, download:`${seg.label.replace(/\s+/g,'_')}.ics`});
      a.click();
      URL.revokeObjectURL(url);
      document.getElementById('icsMsg').textContent = '  (downloaded)';
      setTimeout(()=>document.getElementById('icsMsg').textContent='', 3000);
    });

    setActive(activeKey);
    setInterval(()=>{ tick(); soundTick(); }, 1000);
  </script>
  <!-- Leaflet.js CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
</body>
</html>
